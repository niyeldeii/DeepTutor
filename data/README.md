# Data Directory

This directory stores all data files for the OpenTutor system, including knowledge bases, user data, logs, and more.

## ğŸ“ Directory Structure

```
data/
â”œâ”€â”€ knowledge_bases/          # Knowledge base storage directory
â”‚   â”œâ”€â”€ kb_config.json        # Knowledge base configuration file
â”‚   â””â”€â”€ {kb_name}/            # Individual knowledge base directories
â”‚       â”œâ”€â”€ metadata.json     # Knowledge base metadata
â”‚       â”œâ”€â”€ numbered_items.json  # Numbered items (definitions, theorems, etc.)
â”‚       â”œâ”€â”€ raw/               # Original documents (PDF/Markdown)
â”‚       â”œâ”€â”€ images/            # Extracted images
â”‚       â”œâ”€â”€ content_list/      # Document content list
â”‚       â””â”€â”€ rag_storage/       # RAG knowledge graph storage
â”‚           â”œâ”€â”€ graph_chunk_entity_relation.graphml
â”‚           â”œâ”€â”€ kv_store_*.json
â”‚           â””â”€â”€ vdb_*.json
â”‚
â””â”€â”€ user/                      # User data directory
    â”œâ”€â”€ solve/                 # Problem solving module output
    â”‚   â””â”€â”€ solve_YYYYMMDD_HHMMSS/
    â”‚       â”œâ”€â”€ investigate_memory.json
    â”‚       â”œâ”€â”€ solve_chain.json
    â”‚       â”œâ”€â”€ citation_memory.json
    â”‚       â”œâ”€â”€ final_answer.md
    â”‚       â””â”€â”€ artifacts/     # Code execution output
    â”‚
    â”œâ”€â”€ question/              # Question generation module output
    â”‚   â””â”€â”€ question_YYYYMMDD_HHMMSS/
    â”‚
    â”œâ”€â”€ research/              # Research module output
    â”‚   â”œâ”€â”€ cache/             # Research cache
    â”‚   â”‚   â””â”€â”€ research_*/    # Queue and intermediate results
    â”‚   â””â”€â”€ reports/           # Research reports
    â”‚       â””â”€â”€ research_*.md
    â”‚
    â”œâ”€â”€ guide/                 # Guided learning output
    â”‚   â””â”€â”€ session_{session_id}.json
    â”‚
    â”œâ”€â”€ notebook/              # Notebook data
    â”‚   â””â”€â”€ notebooks_index.json
    â”‚
    â”œâ”€â”€ co-writer/             # Co-Writer output
    â”‚   â”œâ”€â”€ audio/             # TTS audio files
    â”‚   â””â”€â”€ tool_calls/        # Tool call history
    â”‚
    â”œâ”€â”€ logs/                  # System logs
    â”‚   â””â”€â”€ ai_tutor_*.log
    â”‚
    â”œâ”€â”€ run_code_workspace/    # Code execution workspace
    â”‚
    â””â”€â”€ user_history.json      # User activity history
```

## ğŸ“‹ Directory Description

### knowledge_bases/

Stores all knowledge base data files. Each knowledge base contains:

- **metadata.json**: Knowledge base metadata, including creation time, update time, update history, etc.
- **numbered_items.json**: Extracted numbered items (Definition, Theorem, Formula, etc.)
- **raw/**: Original uploaded documents (PDF, Markdown, etc.)
- **images/**: Images extracted from documents
- **content_list/**: Document content list (JSON format)
- **rag_storage/**: RAG knowledge graph storage files
  - `graph_chunk_entity_relation.graphml`: Knowledge graph structure
  - `kv_store_*.json`: Key-value storage (documents, entities, relations, etc.)
  - `vdb_*.json`: Vector database indices

### user/

Stores all user-generated data and output files.

#### solve/

Problem solving module output directory. Each solving task generates a timestamped directory:
- `investigate_memory.json`: Analysis Loop memory data
- `solve_chain.json`: Complete Solve Loop steps and tool call records
- `citation_memory.json`: Citation management data
- `final_answer.md`: Final answer (Markdown format)
- `artifacts/`: Files generated by code execution (images, data files, etc.)

#### question/

Question generation module output directory. Each question generation task generates a timestamped directory containing generated questions and validation results.

#### research/

Research module output directory:
- `cache/`: Intermediate data during research (queue state, planning results, etc.)
- `reports/`: Final generated research reports (Markdown format)

#### guide/

Guided learning module output directory. Each learning session is saved as a JSON file containing session state, knowledge points, chat history, etc.

#### notebook/

Notebook data storage. `notebooks_index.json` contains index information for all notebooks.

#### co-writer/

Co-Writer module output directory:
- `audio/`: TTS-generated audio files
- `tool_calls/`: AI tool call history

#### logs/

System log files, named by date.

#### run_code_workspace/

Code execution tool workspace for temporarily storing files generated by code execution.

## ğŸ”§ Configuration

Data directory paths are configured in `config/main.yaml`:

```yaml
paths:
  user_data_dir: "./data/user"
  knowledge_bases_dir: "./data/knowledge_bases"
  user_log_dir: "./data/user/logs"
```

## ğŸ“ Notes

1. **Backup Important Data**: Recommend regularly backing up `knowledge_bases/` and important user data
2. **Version Control**: Recommend adding `data/` directory to `.gitignore` to avoid committing large files
3. **Disk Space**: Knowledge bases and user data may occupy significant disk space, clean old data regularly
4. **Permission Management**: Ensure application has read/write permissions
5. **Path Consistency**: All modules use unified path configuration, avoid hardcoded paths

## ğŸ”— Related Modules

- **Knowledge Base Management**: `src/knowledge/` - Knowledge base creation, updates, queries
- **User Data**: Each functional module automatically manages its corresponding user data directory
- **Logging System**: `src/core/logging/` - Unified logging management

## ğŸ› ï¸ Maintenance Operations

### Clean Old Data

```bash
# Clean old solving records (keep last 30 days)
find data/user/solve -type d -mtime +30 -exec rm -rf {} \;

# Clean old log files (keep last 7 days)
find data/user/logs -name "*.log" -mtime +7 -delete
```

### Backup Knowledge Base

```bash
# Backup entire knowledge base directory
tar -czf knowledge_bases_backup_$(date +%Y%m%d).tar.gz data/knowledge_bases/

# Backup specific knowledge base
tar -czf ai_textbook_backup.tar.gz data/knowledge_bases/ai-textbook/
```

### Restore Knowledge Base

```bash
# Restore knowledge base
tar -xzf knowledge_bases_backup_20250101.tar.gz -C data/
```
